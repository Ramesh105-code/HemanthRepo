<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meal Explorer</title>
  <meta name="description" content="Responsive Meal Explorer using TheMealDB API ‚Äî search, filter, sort, pagination, suggestions, loader" />
  <style>
   
    :root{--accent:#ff6b6b;--muted:#6b7280;--card-bg:#ffffff;--bg:#f3f4f6}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial;line-height:1.4;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:0 16px}

    header{display:flex;flex-direction:column;gap:12px;margin-bottom:18px}
    .top{display:flex;gap:12px;align-items:center}
    h1{margin:0;font-size:1.4rem}

    .search-wrap{position:relative;flex:1;min-width:220px}
    input[type="search"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #e5e7eb;background:white}
    .suggestions{position:absolute;left:0;right:0;background:white;border:1px solid #e5e7eb;border-top:0;max-height:220px;overflow:auto;border-bottom-left-radius:10px;border-bottom-right-radius:10px;z-index:10}
    .suggestions button{display:block;width:100%;text-align:left;padding:8px 10px;border:0;background:transparent;border-bottom:1px solid #f3f4f6;cursor:pointer}
    .suggestions button:hover{background:#f9fafb}

    .controls{display:flex;gap:12px;align-items:center}
    select, button{padding:8px 10px;border-radius:8px;border:1px solid #e5e7eb;background:white}
    .small{padding:6px 8px;font-size:0.9rem}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:540px){.top{flex-direction:column;align-items:stretch}.controls{flex-direction:column}.grid{grid-template-columns:1fr}}

    .card{background:var(--card-bg);border-radius:12px;padding:0;overflow:hidden;box-shadow:0 6px 18px rgba(15,23,42,0.06);display:flex;flex-direction:column}
    .card img{width:100%;height:170px;object-fit:cover}
    .card .meta{padding:10px 12px;display:flex;flex-direction:column;gap:6px}
    .category{font-size:0.8rem;color:var(--muted)}
    .meal-name{font-weight:600}

    .pagination{display:flex;gap:8px;justify-content:center;margin:18px 0;flex-wrap:wrap}
    .page-btn{padding:8px 12px;border-radius:8px;border:1px solid #e5e7eb;background:white;cursor:pointer}
    .page-btn[disabled]{opacity:0.5;cursor:not-allowed}

   
    .loader-wrap{display:flex;justify-content:center;padding:40px 0}
    .lds-ring{display:inline-block;position:relative;width:64px;height:64px}
    .lds-ring div{box-sizing:border-box;display:block;position:absolute;width:51px;height:51px;margin:6px;border:6px solid #cbd5e1;border-radius:50%;animation:lds-ring 1.2s cubic-bezier(.5,.0,.5,1) infinite;border-color:#cbd5e1 transparent transparent transparent}
    .lds-ring div:nth-child(1){animation-delay:-0.45s}
    .lds-ring div:nth-child(2){animation-delay:-0.3s}
    .lds-ring div:nth-child(3){animation-delay:-0.15s}
    @keyframes lds-ring{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    .empty{padding:48px;text-align:center;color:var(--muted)}

    footer{font-size:0.85rem;color:var(--muted);text-align:center;margin:28px 0}

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="top">
        <h1>üçΩÔ∏è Meal Explorer</h1>
        <div style="flex:1"></div>
        <div class="controls">
          <div class="search-wrap">
            <input id="search" type="search" placeholder="Search meals by name..." aria-label="Search meals" />
            <div id="suggestions" class="suggestions" style="display:none"></div>
          </div>
          <select id="categorySelect" class="small">
            <option value="all">All Categories</option>
          </select>
          <select id="sortSelect" class="small">
            <option value="default">Sort: Default</option>
            <option value="name-asc">Name: A ‚Üí Z</option>
            <option value="name-desc">Name: Z ‚Üí A</option>
          </select>
        </div>
      </div>
      <div style="display:flex;gap:12px;align-items:center">
        <small class="muted">Tip:</small>
        <small class="muted">Type to search (500ms debounce). Click suggestions to show a single meal. Pagination enabled.</small>
      </div>
    </header>

    <main>
      <div id="results" class="grid"></div>
      <div id="loader" class="loader-wrap" style="display:none"><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>
      <div id="empty" class="empty" style="display:none">No meals found.</div>
      <nav id="pagination" class="pagination"></nav>
    </main>

    <footer>
      Built with <a href="https://www.themealdb.com" target="_blank" rel="noopener">TheMealDB</a>. Deploy to GitHub + Netlify.
    </footer>
  </div>

  <script>
    
    const API_BASE = 'https://www.themealdb.com/api/json/v1/1';
    const PAGE_SIZE = 9;
    const DEBOUNCE_MS = 500;
    const PAGINATION_THROTTLE_MS = 400;

    
    let allMeals = []; 
    let filteredMeals = []; 
    let currentPage = 1;
    let lastPaginationClick = 0;

    const searchInput = document.getElementById('search');
    const suggestionsEl = document.getElementById('suggestions');
    const categorySelect = document.getElementById('categorySelect');
    const sortSelect = document.getElementById('sortSelect');
    const resultsEl = document.getElementById('results');
    const paginationEl = document.getElementById('pagination');
    const loaderEl = document.getElementById('loader');
    const emptyEl = document.getElementById('empty');

   
    function showLoader(){loaderEl.style.display='flex';resultsEl.style.display='none';paginationEl.style.display='none';emptyEl.style.display='none'}
    function hideLoader(){loaderEl.style.display='none';resultsEl.style.display='grid';paginationEl.style.display='flex'}

    function debounce(fn, ms){let t;return(...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args), ms)}}
    function throttleClicks(fn, wait){return(...args)=>{const now=Date.now();if(now - lastPaginationClick < wait) return;lastPaginationClick = now;fn(...args)}}

    function createCard(meal){
      const div = document.createElement('div');div.className='card';
      const img = document.createElement('img');img.src = meal.strMealThumb;img.alt = meal.strMeal;
      const meta = document.createElement('div');meta.className='meta';
      const cat = document.createElement('div');cat.className='category';cat.textContent = meal.strCategory || 'Unknown';
      const name = document.createElement('div');name.className='meal-name';name.textContent = meal.strMeal;
      meta.appendChild(name);meta.appendChild(cat);
      div.appendChild(img);div.appendChild(meta);
      return div;
    }

    async function fetchCategories(){
      try{
        const res = await fetch(`${API_BASE}/list.php?c=list`);
        const data = await res.json();
        const cats = data.meals.map(m=>m.strCategory);
        populateCategories(cats);
      }catch(err){console.error('Category fetch failed',err)}
    }

    function populateCategories(categories){
      categories.forEach(c=>{
        const opt = document.createElement('option');opt.value=c;opt.textContent=c;categorySelect.appendChild(opt);
      })
    }

    async function initialLoad(){
      showLoader();
      try{
        
        const seedCats = ['Seafood','Chicken','Beef','Vegetarian','Dessert'];
        const promises = seedCats.map(c=>fetch(`${API_BASE}/filter.php?c=${encodeURIComponent(c)}`).then(r=>r.json()).catch(()=>null));
        const results = await Promise.all(promises);
       
        const mealsShort = results.filter(Boolean).flatMap(r=>r.meals || []).slice(0,60);

        const ids = [...new Set(mealsShort.map(m=>m.idMeal))].slice(0,60);
        const detailPromises = ids.map(id=>fetch(`${API_BASE}/lookup.php?i=${id}`).then(r=>r.json()).then(d=>d.meals && d.meals[0]).catch(()=>null));
        const detailResults = await Promise.all(detailPromises);
        allMeals = detailResults.filter(Boolean);
        applyFiltersAndRender();
      }catch(err){console.error(err);}
      hideLoader();
    }

    async function searchMealsByName(q){
      if(!q) return [];
      showLoader();
      try{
        const res = await fetch(`${API_BASE}/search.php?s=${encodeURIComponent(q)}`);
        const data = await res.json();
        hideLoader();
        return data.meals || [];
      }catch(err){console.error(err);hideLoader();return []}
    }

   
    function applyFiltersAndRender(){
      
      let arr = [...allMeals];
      const cat = categorySelect.value;
      const sort = sortSelect.value;
      const query = searchInput.dataset.selectedMeal ? null : (searchInput.value || '').trim().toLowerCase();

      if(cat && cat !== 'all'){
        arr = arr.filter(m=>m.strCategory && m.strCategory.toLowerCase() === cat.toLowerCase());
      }
      if(query){
        arr = arr.filter(m=>m.strMeal.toLowerCase().includes(query));
      }

      if(sort === 'name-asc') arr.sort((a,b)=>a.strMeal.localeCompare(b.strMeal));
      else if(sort === 'name-desc') arr.sort((a,b)=>b.strMeal.localeCompare(a.strMeal));

      filteredMeals = arr;
      currentPage = 1; 
      renderPage();
    }

    function renderPage(){
      resultsEl.innerHTML='';
      if(!filteredMeals || filteredMeals.length===0){emptyEl.style.display='block';paginationEl.style.display='none';return}
      emptyEl.style.display='none';

      const total = filteredMeals.length;
      const pages = Math.ceil(total / PAGE_SIZE);
      if(currentPage > pages) currentPage = pages;
      const start = (currentPage - 1) * PAGE_SIZE;
      const pageItems = filteredMeals.slice(start, start + PAGE_SIZE);

      pageItems.forEach(m=>resultsEl.appendChild(createCard(m)));

      paginationEl.innerHTML='';
      if(pages > 1){
        const prev = document.createElement('button');prev.className='page-btn';prev.textContent='Prev';prev.disabled = currentPage===1;prev.addEventListener('click', throttlePagination(()=>{currentPage--;renderPage()}));
        paginationEl.appendChild(prev);
       
        const visible = 5;let startPage = Math.max(1, currentPage - Math.floor(visible/2));
        if(startPage + visible -1 > pages) startPage = Math.max(1, pages - visible +1);
        for(let p = startPage; p<=Math.min(pages, startPage+visible-1); p++){
          const b = document.createElement('button');b.className='page-btn';b.textContent = p;b.disabled = p===currentPage;b.addEventListener('click', throttlePagination(()=>{currentPage=p;renderPage()}));paginationEl.appendChild(b);
        }
        const next = document.createElement('button');next.className='page-btn';next.textContent='Next';next.disabled = currentPage===pages;next.addEventListener('click', throttlePagination(()=>{currentPage++;renderPage()}));
        paginationEl.appendChild(next);
      }
    }

    function throttlePagination(fn){return ()=>{const now=Date.now();if(now - lastPaginationClick < PAGINATION_THROTTLE_MS) return; lastPaginationClick = now;fn();}}

    const debouncedSuggest = debounce(async function(){
      const q = searchInput.value.trim();
      if(!q){suggestionsEl.style.display='none';searchInput.removeAttribute('data-selected-meal');applyFiltersAndRender();return}
     
      const results = await searchMealsByName(q);
      if(!results || results.length===0){suggestionsEl.style.display='none';return}
     
      suggestionsEl.innerHTML='';
      results.slice(0,8).forEach(m=>{
        const btn = document.createElement('button');btn.type='button';btn.textContent = m.strMeal + (m.strCategory ? ` ‚Äî ${m.strCategory}` : '');
        btn.addEventListener('click', ()=>{
          
          searchInput.value = m.strMeal;
          searchInput.dataset.selectedMeal = m.idMeal;
          suggestionsEl.style.display='none';
        
          allMeals = [m];
          applyFiltersAndRender();
        });
        suggestionsEl.appendChild(btn);
      });
      suggestionsEl.style.display='block';
    }, DEBOUNCE_MS);

    document.addEventListener('click', (e)=>{
      if(!document.querySelector('.search-wrap').contains(e.target)) suggestionsEl.style.display='none';
    });

    searchInput.addEventListener('input', (e)=>{
      if(!e.target.value) searchInput.removeAttribute('data-selected-meal');
      debouncedSuggest();
    });

    searchInput.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        debouncedSuggest.cancel?.(); 
      
        (async ()=>{
          const q = searchInput.value.trim();
          if(!q){applyFiltersAndRender();return}
          showLoader();
          const res = await searchMealsByName(q);
          allMeals = res;
          applyFiltersAndRender();
          hideLoader();
        })();
      }
    });

    categorySelect.addEventListener('change', ()=>{
     
      const cat = categorySelect.value;
      if(cat==='all'){
      
        applyFiltersAndRender();
      }else{
       
        (async ()=>{
          showLoader();
          try{
            const res = await fetch(`${API_BASE}/filter.php?c=${encodeURIComponent(cat)}`);
            const data = await res.json();
            const ids = (data.meals || []).map(m=>m.idMeal).slice(0,60);
            const detailPromises = ids.map(id=>fetch(`${API_BASE}/lookup.php?i=${id}`).then(r=>r.json()).then(d=>d.meals && d.meals[0]).catch(()=>null));
            const details = await Promise.all(detailPromises);
            allMeals = details.filter(Boolean);
            applyFiltersAndRender();
          }catch(err){console.error(err)}
          hideLoader();
        })();
      }
    });

    sortSelect.addEventListener('change', ()=>{applyFiltersAndRender()});


    (async function(){
      await fetchCategories();
      await initialLoad();
    
      searchInput.addEventListener('focus', ()=>{if(suggestionsEl.children.length) suggestionsEl.style.display='block'})
    })();

    (function addCancelToDebounce(){
      const orig = debounce;
      window.debounce = function(fn, ms){
        let t;const wrapped = (...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args), ms)};
        wrapped.cancel = ()=>{clearTimeout(t)};
        return wrapped;
      }
    })();

  </script>

</body>
</html>
